<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario</title>
    <link rel="stylesheet" href="assets/AdminLTE-3.2.0/dist/css/adminlte.min.css">
    <link rel="stylesheet" href="assets/AdminLTE-3.2.0/plugins/fontawesome-free/css/all.min.css">
    <link rel="stylesheet" href="assets/AdminLTE-3.2.0/plugins/sweetalert2-theme-bootstrap-4/bootstrap-4.min.css">
    <link rel="stylesheet" href="assets/styles.css">
</head>

<body class="hold-transition login-page">
    <div class="login-box">
        <div class="card">
          <div class="card card-primary" style="background-color: #777DA7; text-align: center; color: white;">
            <div class="card-title">
              <h1>Iniciar sesion</h1>
            </div>
          </div>
          
          <div class="card-body login-card-body">
            
            
            <form id="loginForm" method="post">
              <label for="txtcaja">Usuario</label>
              <!-- Campo de Usuario/Correo -->
                <div class="input-group mb-3">
                  <input type="text" name="usuario_o_correo" class="form-control" placeholder="Usuario o Correo" required>
                  <div class="input-group-append">
                  <div class="input-group-text">
                  <span class="fas fa-user"></span>
                  </div>
                  </div>
                </div>
              <!-- Campo de Contraseña -->
              <label for="txtcaja">Contraseña</label>
              <div class="input-group mb-3">
                <input type="password" name="contraseña" class="form-control" placeholder="Contraseña" required>
                <div class="input-group-append">
                  <div class="input-group-text">
                    <span class="fas fa-lock"></span>
                  </div>
                </div>
              </div>
              <!-- Botón de Inicio de Sesión -->
              <div class="row">
                <div class="col-12" style="text-align: center">
                  <button type="submit" class="btn btn-login btn-block">Iniciar Sesión</button>
                  <button type="button" class="btn btn-registrar btn-block" data-toggle="modal" data-target="#modal-dafult"> Registrate</button>
                </div>
              </div>
            </form>
          </div>
        </div>
    </div>

  <!--Ventana Modal para registro de usuarios-->
    <div class="modal fade" id="modal-dafult">
      <div class="modal-dialog modal-xl">
          <div class="modal-content">
              <div class="modal-header encabezado-menu-registro">
                  <h4 class="modal-title">Registrate</h4>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
              </div>
              <div class="modal-body">
                <label for="txtcaja">Usuario</label>
                <!-- Campo de Usuario/Correo -->
                  <div class="input-group mb-3">
                    <input type="text" name="usuario_o_correo" class="form-control" placeholder="Usuario" id="registro_usuario"required>
                    <div class="input-group-append">
                    <div class="input-group-text">
                    <span class="fas fa-user"></span>
                    </div>
                    </div>
                  </div>
                  <label for="txtcaja">Correo</label>
                  <!-- Campo de Correo -->
                    <div class="input-group mb-3">
                      <input type="text" name="usuario_o_correo" class="form-control" placeholder="Correo" id="registro_correo"required>
                      <div class="input-group-append">
                      <div class="input-group-text">
                      <span class="fas fa-envelope"></span>
                      </div>
                      </div>
                    </div>
                <!-- Campo de Contraseña -->
                <label for="txtcaja">Contraseña</label>
                <div class="input-group mb-3">
                  <input type="password" name="contraseña" class="form-control" placeholder="Contraseña" id="registro_contra"required>
                  <div class="input-group-append">
                    <div class="input-group-text">
                      <span class="fas fa-lock"></span>
                    </div>
                  </div>
                </div>
              </div>
              <!--BOTON DE REGISTRAAAR-->
              <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">
                Registrar
              </button>
              </div>
          </div>
      </div>
  </div>
    <script src="assets/AdminLTE-3.2.0/plugins/jquery/jquery.js"></script>
    <script src="assets/AdminLTE-3.2.0/plugins/bootstrap/js/bootstrap.bundle.js"></script>
    <script src="assets/AdminLTE-3.2.0/dist/js/adminlte.js"></script>
    <script src="assets/AdminLTE-3.2.0/plugins/sweetalert2/sweetalert2.all.min.js"></script>

    <script>
      $(document).ready(function() {
          // Interceptar el envío del formulario de Login
          $("#loginForm").on("submit", function(e) {
              e.preventDefault(); // Evita que se recargue la página
        
              $.ajax({
                  type: "POST",
                  url: "backend/procesar_login.php", // Archivo PHP que procesará el login
                  data: $(this).serialize(),
                  dataType: "json",
                  success: function(response) {
                      if (response.success) {
                          // Animación de éxito
                          Swal.fire({
                              icon: 'success',
                              title: 'Éxito',
                              text: response.message,
                              timer: 700,
                              showConfirmButton: false,
                              allowOutsideClick: false,
                              allowEscapeKey: false,
                              allowEnterKey: false
                          }).then(() => {
                              window.location.href = response.redirect;
                          });
                      } else {
                          // Animación de error
                          Swal.fire({
                              icon: 'error',
                              title: 'Error',
                              text: response.message
                          });
                      }
                  },
                  error: function() {
                      Swal.fire({
                          icon: 'error',
                          title: 'Error',
                          text: 'Ocurrió un error al procesar tu solicitud.'
                      });
                  }
              });
          });
        
          // Manejar el evento del botón de registrar
          $(".btn-default").on("click", function() {
              var correo = $("#registro_correo").val();
              var correoValido = /^[a-zA-Z0-9._-]+@[sitio del correo]+$/; // Expresión regular para validar el correo
    
              if (!correoValido.test(correo)) {
                  // Mostrar mensaje de error si el correo no es válido
                  Swal.fire({
                      icon: 'error',
                      title: 'Correo inválido',
                      text: 'Por favor, introduce un correo que termine en @gmail @outlook etc...'
                  });
                  return; // Detener el proceso si el correo no es válido
              }
    
              // Simulación del envío de registro con AJAX si el correo es válido
              $.ajax({
                  type: "POST",
                  url: "backend/procesar_registro.php", // Archivo PHP que procesará el registro
                  data: {
                      usuario: $("#registro_usuario").val(),
                      correo: correo,
                      contraseña: $("#registro_contra").val()
                  },
                  dataType: "json",
                  success: function(response) {
                      if (response.success) {
                          // Animación de éxito
                          Swal.fire({
                              icon: 'success',
                              title: 'Registrado',
                              text: response.message,
                              timer: 700,
                              showConfirmButton: false,
                              allowOutsideClick: false,
                              allowEscapeKey: false,
                              allowEnterKey: false
                          }).then(() => {
                              // Redirigir o cerrar el modal
                              $('#modal-dafult').modal('hide');
                          });
                      } else {
                          // Animación de error
                          Swal.fire({
                              icon: 'error',
                              title: 'Error en el registro',
                              text: response.message
                          });
                      }
                  },
                  error: function() {
                      Swal.fire({
                          icon: 'error',
                          title: 'Error',
                          text: 'Ocurrió un error al procesar tu registro.'
                      });
                  }
              });
          });
      });
    </script>
    
  

</body>
</html>





